---
title: cp4 处理器体系结构
date: 2023-05-24 14:35:45
updated: 2023-05-24 15:45:42
categories:
  - Study
tags:
  - csapp
toc: true
---
# Y86-64 指令集体系结构

## 程序员可见状态

![](../../../static/CSAPP/cp4/f4.1Y86-64.png)

- 省略了 %r15 以简化指令的编码
- 三个一体的条件码：ZF、SF 和 OF
- Stat：状态码，表明程序执行的总体状态

## Y86-64 指令

Y86-64 指令集基本上是 x86-64 指令集的一个子集，它只包括 8 字节整数操作，寻址方式较少，操作也较少。下面是一些细节：

- 左边是指令的汇编码表示，右边是字节编码
- X 86-64 的 movq 指令分成了 4 个不同的指令：irmovq、rrmovq、mrmovq 和 rmmovq
	- 分别显式地指明源和目的的格式
	- 源可以是立即数（i）、寄存器（r）或内存（m），指令名字第一个字母就表明了源的类型
	- 目的可以是寄存器（r）和内存（m），指令名字第二个字母指明了目的的类型
- 和 x 86-64 一样，不允许从一个内存地址直接传送到另一个内存地址。
	- 另外，也不允许将立即数传送到内存
- 有 4 个整数操作指令，如 OPg，它们是 addq、subq、andq 和 xorq
	- 只会对寄存器数据进行操作，而 x86-64 还允许对内存数据进行这些操作
	- 它们会设置三个条件码
- halt 指令停止指令的执行。x86-64 中有一个与之相当的 hlt
	- x86-64 的应用程序不允许使用这条指令，它会导致整个系统暂停运行
	- 对于 Y86-64 来说，执行 halt 指令会导致处理停止运行，并将状态码设置为 HLT

![](../../../static/CSAPP/cp4/f4.2Y86-64instruction.png)

- 指令编码长度从 1 个字节到 10 个字节不等
- 一条指令含有一个单字节的指令指示符，可能含有一个单字节的寄存器指示符，还可能含有一个 8 字节的常数字
- fn 指明是某个整数操作（OPg）、数据传送条件（cmovXX）或是分支条件（jXX）
- 所有的数值均用十六进制表示

## 指令编码

每条指令需要 1~ 10 个字节不等，每条指令的第一个字节表明指令的类型
- 这个字节分为两个部分
- 高四位是代码部分
- 第四位是功能部分
- 如图 4.2 所示，代码值为 0~0xB

![](../../../static/CSAPP/cp4/f4.3Function%20codes.png)

Y86-64 中的寄存器编号和 x86-64 相同，当需要指明不应访问任何寄存器时，就用 ID 值 0xF 来表示 

![](../../../static/CSAPP/cp4/f4.4register%20identifiers.png)

## Y86-64 异常

![](../../../static/CSAPP/cp4/f4.5status%20codes.png)

## 