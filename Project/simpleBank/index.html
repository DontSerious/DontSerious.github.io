<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>go simpleBank project - Tomato&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Tomato&#039;s Blog"><meta name="msapplication-TileImage" content="static/avatar.jpg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Tomato&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="环境  go Gin gomock golang-migrate postgres sqlc Docker Makefile Viper zerolog asynq  go 第三方包  github.com&amp;#x2F;stretchr&amp;#x2F;testify：测试 github.com&amp;#x2F;lib&amp;#x2F;pq：postgres 驱动  Docker-compose 123456789101112131415161718192"><meta property="og:type" content="article"><meta property="og:title" content="go simpleBank project"><meta property="og:url" content="https://tomatoblog.netlify.app/Project/simpleBank/"><meta property="og:site_name" content="Tomato&#039;s Blog"><meta property="og:description" content="环境  go Gin gomock golang-migrate postgres sqlc Docker Makefile Viper zerolog asynq  go 第三方包  github.com&amp;#x2F;stretchr&amp;#x2F;testify：测试 github.com&amp;#x2F;lib&amp;#x2F;pq：postgres 驱动  Docker-compose 123456789101112131415161718192"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://tomatoblog.netlify.app/static/project/grpc%20gateway.png"><meta property="article:published_time" content="2024-03-12T13:26:08.000Z"><meta property="article:modified_time" content="2024-03-31T09:31:36.000Z"><meta property="article:author" content="TOMATO"><meta property="article:tag" content="go"><meta property="article:tag" content="simpleBank"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://tomatoblog.netlify.app/static/project/grpc%20gateway.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomatoblog.netlify.app/Project/simpleBank/"},"headline":"go simpleBank project","image":["https://tomatoblog.netlify.app/static/project/grpc%20gateway.png"],"datePublished":"2024-03-12T13:26:08.000Z","dateModified":"2024-03-31T09:31:36.000Z","author":{"@type":"Person","name":"TOMATO"},"publisher":{"@type":"Organization","name":"Tomato's Blog","logo":{"@type":"ImageObject","url":{"light":"static/avatar.jpg","dark":"static/avatar.jpg"}}},"description":"环境  go Gin gomock golang-migrate postgres sqlc Docker Makefile Viper zerolog asynq  go 第三方包  github.com&#x2F;stretchr&#x2F;testify：测试 github.com&#x2F;lib&#x2F;pq：postgres 驱动  Docker-compose 123456789101112131415161718192"}</script><link rel="canonical" href="https://tomatoblog.netlify.app/Project/simpleBank/"><link rel="icon" href="/static/avatar.jpg"><link rel="stylesheet" href="/css/font/fontawesome/css/all.min.css"><link rel="stylesheet" href="/js/imaegoo/highlight.js/11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="/js/imaegoo/cookieconsent/3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="/js/imaegoo/lightgallery/1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="/js/imaegoo/justifiedGallery/3.8.1/dist/css/justifiedGallery.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="/js/imaegoo/pace-js/1.2.4/pace.min.js"></script><script>(function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();</script><meta name="generator" content="Hexo 7.1.1"></head><body class="is-3-column"><script type="text/javascript" src="/js/imaegoo/night.js"></script><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img class="logo-img" src="/static/avatar.jpg" alt="Tomato&#039;s Blog" height="28"><img class="logo-img-dark" src="/static/avatar.jpg" alt="Tomato&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives/">时间轴</a><a class="navbar-item" href="/categories/">分类</a><a class="navbar-item" href="/tags/">标签</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i><span>  目录</span></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time datetime="2024-03-12T13:26:08.000Z" title="3/12/2024, 1:26:08 PM">2024-03-12</time>发表</span><span class="level-item"><time datetime="2024-03-31T09:31:36.000Z" title="3/31/2024, 9:31:36 AM">2024-03-31</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Project/">Project</a></span><span class="level-item">13 分钟读完 (大约2014个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">go simpleBank project</h1><div class="content"><h1 id="环境">环境</h1><ul><li>go</li><li>Gin</li><li>gomock</li><li>golang-migrate</li><li>postgres</li><li>sqlc</li><li>Docker</li><li>Makefile</li><li>Viper</li><li>zerolog</li><li>asynq</li></ul><h2 id="go">go</h2><h3 id="第三方包">第三方包</h3><ul><li><code>github.com/stretchr/testify</code>：测试</li><li><code>github.com/lib/pq</code>：postgres 驱动</li></ul><h2 id="Docker-compose">Docker-compose</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">postgres:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">simpleBank-postgres</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:alpine</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="comment"># set shared memory limit when using docker-compose</span></span><br><span class="line">    <span class="comment"># shm_size: 128mb</span></span><br><span class="line">    <span class="comment"># or set shared memory limit when deploy via swarm stack</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./.docker-data/postgres/db:/var/lib/postgresql/data:z</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">run:/var/run</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">POSTGRES_USER:</span> <span class="string">tomato</span></span><br><span class="line">      <span class="attr">POSTGRES_PASSWORD:</span> <span class="string">joker</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="comment"># ports:</span></span><br><span class="line">        <span class="comment">#   - 9090:9090</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&quot;-c TimeZone=Asia/Shanghai -c log_timezone=Asia/Shanghai -c unix_socket_permissions=0777&quot;</span></span><br><span class="line">    <span class="comment"># command: &quot;-c TimeZone=Asia/Shanghai -c log_timezone=Asia/Shanghai -c listen_addresses=&#x27;&#x27; -c unix_socket_permissions=0777&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">run:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Postgres">Postgres</h3><ul><li>网络使用 host 模式， <code>localhost:5432</code> 即可访问</li><li>执行 <code>psql -U tomato</code> 即可以 tomato 的身份进入 postgres</li></ul><h2 id="migrate">migrate</h2><h3 id="golang-invoke-migrate">golang invoke migrate</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runDBMigration</span><span class="params">(migrationUrl, dbSource <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	migration, err := migrate.New(migrationUrl, dbSource)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;cannot create new migrate instance&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 防止发生 no change fatal 导致无法启动</span></span><br><span class="line">	<span class="keyword">if</span> err = migration.Up(); err != <span class="literal">nil</span> &amp;&amp; err != migrate.ErrNoChange &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;failed to run migrate up: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	log.Println(<span class="string">&quot;db migrate successfully.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Init-schema">Init_schema</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># init_schema</span></span><br><span class="line">migrate create -ext sql -<span class="built_in">dir</span> db/migration/ -<span class="built_in">seq</span> init_schema</span><br><span class="line"></span><br><span class="line">/home/soft/simple_bank/db/migration/000001_init_schema.up.sql</span><br><span class="line">/home/soft/simple_bank/db/migration/000001_init_schema.down.sql</span><br></pre></td></tr></table></figure><ul><li>migrate up 会执行 up 脚本</li><li>migrate down 会执行 down 脚本</li></ul><h3 id="new-migrate-version">new migrate version</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">migrate create -ext sql -<span class="built_in">dir</span> db/migration/ -<span class="built_in">seq</span> add_users</span><br></pre></td></tr></table></figure><p>然后在新的 sql 文件添加新的内容</p><h2 id="Sqlc">Sqlc</h2><h3 id="配置">配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">organization:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">project:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">sql:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">engine:</span> <span class="string">&quot;postgresql&quot;</span></span><br><span class="line">    <span class="attr">queries:</span> <span class="string">&quot;./db/query/&quot;</span> <span class="comment"># query查询保存目录，用于生成代码</span></span><br><span class="line">    <span class="attr">schema:</span> <span class="string">&quot;./db/migration/&quot;</span> <span class="comment"># 表 sql 地址</span></span><br><span class="line">    <span class="attr">gen:</span></span><br><span class="line">      <span class="attr">go:</span></span><br><span class="line">        <span class="attr">package:</span> <span class="string">&quot;db&quot;</span> <span class="comment"># go package name</span></span><br><span class="line">        <span class="attr">out:</span> <span class="string">&quot;./db/sqlc&quot;</span> <span class="comment"># go 代码位置</span></span><br><span class="line">        <span class="attr">emit_json_tags:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">emit_prepared_queries:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">emit_interface:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">emit_exact_table_names:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">overrides:</span></span><br><span class="line">    <span class="attr">go:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">plugins:</span> []</span><br><span class="line"><span class="attr">rules:</span> []</span><br><span class="line"><span class="attr">options:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="可选参数">可选参数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name: UpdateUser :one</span></span><br><span class="line"><span class="keyword">UPDATE</span> users</span><br><span class="line"><span class="keyword">SET</span></span><br><span class="line">    hashed_password <span class="operator">=</span> <span class="built_in">COALESCE</span>(sqlc.narg(hashed_password), hashed_password),</span><br><span class="line">    full_name <span class="operator">=</span> <span class="built_in">COALESCE</span>(sqlc.narg(full_name), full_name),</span><br><span class="line">    email <span class="operator">=</span> <span class="built_in">COALESCE</span>(sqlc.narg(email), email)</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    username <span class="operator">=</span> sqlc.arg(username)</span><br><span class="line">RETURNING <span class="operator">*</span>;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">updateUser, err := testQueries.UpdateUser(context.Background(), UpdateUserParams&#123;</span><br><span class="line">		Username: oldUser.Username,</span><br><span class="line">		HashedPassword: sql.NullString&#123;</span><br><span class="line">			String: newHashedPassword,</span><br><span class="line">			Valid:  <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		Email: sql.NullString&#123;</span><br><span class="line">			String: newEmail,</span><br><span class="line">			Valid:  <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		FullName: sql.NullString&#123;</span><br><span class="line">			String: newFullName,</span><br><span class="line">			Valid:  <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure><p>protobuf</p><figure class="highlight proto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">UpdateUserRequest</span> &#123;</span><br><span class="line">    <span class="type">string</span> username = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">optional</span> <span class="type">string</span> full_name = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">optional</span> <span class="type">string</span> email = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">optional</span> <span class="type">string</span> password = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Makefile">Makefile</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">dockerup:</span></span><br><span class="line">	docker compose up -d</span><br><span class="line"></span><br><span class="line"><span class="section">createdb:</span></span><br><span class="line">	docker exec -it simpleBank-postgres createdb --username=tomato --owner=tomato simple_bank</span><br><span class="line"></span><br><span class="line"><span class="section">dropdb:</span></span><br><span class="line">	docker exec -it simpleBank-postgres dropdb simple_bank --username=tomato</span><br><span class="line"></span><br><span class="line"><span class="section">migrateup:</span></span><br><span class="line">	./tools/migrate -path db/migration/ -database <span class="string">&quot;postgresql://tomato:joker@192.168.6.153:5432/simple_bank?sslmode=disable&quot;</span> -verbose up</span><br><span class="line"></span><br><span class="line"><span class="section">migratedown:</span></span><br><span class="line">	./tools/migrate -path db/migration/ -database <span class="string">&quot;postgresql://tomato:joker@192.168.6.153:5432/simple_bank?sslmode=disable&quot;</span> -verbose down -all</span><br><span class="line"></span><br><span class="line"><span class="section">sqlc:</span></span><br><span class="line">	./tools/sqlc generate</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: dockerup createdb dropdb migrateup migratedown sqlc</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 执行dockerup下的命令</span><br><span class="line">make dockerup</span><br></pre></td></tr></table></figure><h2 id="Viper">Viper</h2><p>使用包：<code>github.com/spf13/viper</code> 读取配置文件</p><h2 id="gomock">gomock</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/golang/mock/mockgen@v1.6.0</span><br><span class="line">go get github.com/golang/mock/mockgen/model</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用反射生成</span></span><br><span class="line"><span class="comment"># mockgen moduleName/dir interface</span></span><br><span class="line">mockgen -package mockDB -destination db/mock/store.go github.com/DontSerious/simpleBank/db/sqlc Store</span><br></pre></td></tr></table></figure><h3 id="Custom-matcher">Custom matcher</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> eqCreateUserParamsMatcher <span class="keyword">struct</span> &#123;</span><br><span class="line">	arg      db.CreateUserParams</span><br><span class="line">	password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用自己写的工具重新实现matches来自定义对比password</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e eqCreateUserParamsMatcher)</span></span> Matches(x <span class="keyword">interface</span>&#123;&#125;) <span class="type">bool</span> &#123;</span><br><span class="line">	arg, ok := x.(db.CreateUserParams)</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err := util.CheckPassword(e.password, arg.HashedPassword)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	e.arg.HashedPassword = arg.HashedPassword</span><br><span class="line">	<span class="keyword">return</span> reflect.DeepEqual(e.arg, arg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e eqCreateUserParamsMatcher)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;marches args %v and password %v&quot;</span>, e.arg, e.password)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">eqCreateUserParams</span><span class="params">(arg db.CreateUserParams, password <span class="type">string</span>)</span></span> gomock.Matcher &#123;</span><br><span class="line">	<span class="keyword">return</span> eqCreateUserParamsMatcher&#123;arg: arg, password: password&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">testCases := []<span class="keyword">struct</span> &#123;</span><br><span class="line">		name          <span class="type">string</span></span><br><span class="line">		body          gin.H</span><br><span class="line">		buildStubs    <span class="function"><span class="keyword">func</span><span class="params">(store *mockDB.MockStore)</span></span></span><br><span class="line">		checkResponse <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T, recorder *httptest.ResponseRecorder)</span></span></span><br><span class="line">	&#125;&#123;</span><br><span class="line">		&#123;</span><br><span class="line">			name: <span class="string">&quot;OK&quot;</span>,</span><br><span class="line">			body: gin.H&#123;</span><br><span class="line">				<span class="string">&quot;username&quot;</span>:  user.Username,</span><br><span class="line">				<span class="string">&quot;full_name&quot;</span>: user.FullName,</span><br><span class="line">				<span class="string">&quot;email&quot;</span>:     user.Email,</span><br><span class="line">				<span class="string">&quot;password&quot;</span>:  password,</span><br><span class="line">			&#125;,</span><br><span class="line">			buildStubs: <span class="function"><span class="keyword">func</span><span class="params">(store *mockDB.MockStore)</span></span> &#123;</span><br><span class="line">				arg := db.CreateUserParams&#123;</span><br><span class="line">					Username: user.Username,</span><br><span class="line">					FullName: user.FullName,</span><br><span class="line">					Email:    user.Email,</span><br><span class="line">				&#125;</span><br><span class="line">				store.EXPECT().</span><br><span class="line">					<span class="comment">// 在这加入自定义matcher</span></span><br><span class="line">					CreateUser(gomock.Any(), eqCreateUserParams(arg, password)).</span><br><span class="line">					Times(<span class="number">1</span>).</span><br><span class="line">					Return(user, <span class="literal">nil</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			checkResponse: <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T, recorder *httptest.ResponseRecorder)</span></span> &#123;</span><br><span class="line">				require.Equal(t, http.StatusOK, recorder.Code)</span><br><span class="line">				requireBodyMatchUser(t, recorder.Body, user)</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="swagger">swagger</h2><p>使用 swagger ui</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fs := http.FileServer(http.Dir(<span class="string">&quot;./doc/swagger&quot;</span>))</span><br><span class="line">mux.Handle(<span class="string">&quot;/swagger/&quot;</span>, http.StripPrefix(<span class="string">&quot;/swagger/&quot;</span>, fs))</span><br></pre></td></tr></table></figure><p>添加 swagger 文件中的项目信息</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;protoc-gen-openapiv2/options/annotations.proto&quot;</span>;</span><br><span class="line"></span><br><span class="line">option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = &#123;</span><br><span class="line">    info: &#123;</span><br><span class="line">      title: <span class="string">&quot;simple Bank API&quot;</span>;</span><br><span class="line">      version: <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line">      contact: &#123;</span><br><span class="line">        name: <span class="string">&quot;Don&#x27;t Serious&quot;</span>;</span><br><span class="line">        url: <span class="string">&quot;https://github.com/DontSerious/simpleBank&quot;</span>;</span><br><span class="line">        email: <span class="string">&quot;none@example.com&quot;</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="zerolog">zerolog</h2><p>app.env</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENVIRONMENT=dev</span><br></pre></td></tr></table></figure><p>设置不为dev时，logger 打印格式为 json</p><h3 id="grpc">grpc</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logger</span></span><br><span class="line">grpcLogger := grpc.UnaryInterceptor(util.GRPCLogger)</span><br><span class="line"></span><br><span class="line">gRPCServer := grpc.NewServer(grpcLogger)</span><br></pre></td></tr></table></figure><h3 id="HTTP">HTTP</h3><p>以 middleware 形式作用</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log.Info().Msgf(<span class="string">&quot;start HTTP server at %s&quot;</span>, listener.Addr().String())</span><br><span class="line">handler := util.HTTPLogger(mux)</span><br><span class="line">err = http.Serve(listener, handler)</span><br></pre></td></tr></table></figure><p>自定义 ResponseRecorder 获取 body 和 statusCode 信息供 logger 打印</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ResponseRecorder <span class="keyword">struct</span> &#123;</span><br><span class="line">	http.ResponseWriter</span><br><span class="line">	StatusCode <span class="type">int</span></span><br><span class="line">	Body       []<span class="type">byte</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rec *ResponseRecorder)</span></span> WriteHeader(statusCode <span class="type">int</span>) &#123;</span><br><span class="line">	rec.StatusCode = statusCode</span><br><span class="line">	rec.ResponseWriter.WriteHeader(statusCode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rec *ResponseRecorder)</span></span> Write(body []<span class="type">byte</span>) (<span class="type">int</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	rec.Body = body</span><br><span class="line">	<span class="keyword">return</span> rec.ResponseWriter.Write(body)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// middleware</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HTTPLogger</span><span class="params">(handler http.Handler)</span></span> http.Handler &#123;</span><br><span class="line">	<span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		startTime := time.Now()</span><br><span class="line">		rec := &amp;ResponseRecorder&#123;</span><br><span class="line">			ResponseWriter: w,</span><br><span class="line">			StatusCode:     http.StatusOK,</span><br><span class="line">		&#125;</span><br><span class="line">		handler.ServeHTTP(rec, r)</span><br><span class="line">		duration := time.Since(startTime)</span><br><span class="line"></span><br><span class="line">		logger := log.Info()</span><br><span class="line">		<span class="keyword">if</span> rec.StatusCode != http.StatusOK &#123;</span><br><span class="line">			logger = log.Error().Bytes(<span class="string">&quot;body&quot;</span>, rec.Body)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		logger.Str(<span class="string">&quot;protocol&quot;</span>, <span class="string">&quot;http&quot;</span>).</span><br><span class="line">			Str(<span class="string">&quot;method&quot;</span>, r.Method).</span><br><span class="line">			Str(<span class="string">&quot;path&quot;</span>, r.RequestURI).</span><br><span class="line">			Int(<span class="string">&quot;status_code&quot;</span>, rec.StatusCode).</span><br><span class="line">			Str(<span class="string">&quot;status_text&quot;</span>, http.StatusText(rec.StatusCode)).</span><br><span class="line">			Dur(<span class="string">&quot;duration&quot;</span>, duration).</span><br><span class="line">			Msg(<span class="string">&quot;received a HTTP request&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="asynq">asynq</h2><p>使用 redis 实现队列，让服务器异步执行自定义的 task</p><ol><li><strong>Distributor（分发器）</strong>：负责将任务分配给可用处理器（processors）的组件。它的主要职责是将待执行的任务从任务队列中取出，并将其分发给处理器进行处理。Distributor 负责任务的调度和分配，以确保任务能够按照适当的顺序和优先级执行。</li><li><strong>Processor（处理器）</strong>：实际执行异步任务的组件。当 Distributor 将任务分配给处理器时，处理器会负责执行任务所需的操作。处理器根据任务的类型和属性执行相应的处理逻辑，并负责处理任务执行过程中可能出现的错误和异常情况。</li></ol><h1 id="SQL">SQL</h1><h2 id="dbml">dbml</h2><h3 id="cli">cli</h3><p>快速生成 sql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @dbml/cli</span><br><span class="line"></span><br><span class="line">dbml2sql --postgres -o doc/shecma.sql doc/db.dbml</span><br></pre></td></tr></table></figure><h3 id="docs">docs</h3><p>根据 dbml 部署 docs 页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install -g dbdocs</span><br><span class="line"></span><br><span class="line">dbdocs login</span><br><span class="line"></span><br><span class="line">dbdocs build doc/db.dbml</span><br><span class="line"></span><br><span class="line">dbdocs password --<span class="built_in">set</span> tomato --project simple_bank</span><br></pre></td></tr></table></figure><h2 id="sqlc-表查询设计">sqlc 表查询设计</h2><h3 id="account">account</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name: CreateAccount :one</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> accounts (</span><br><span class="line">    owner, </span><br><span class="line">    balance, </span><br><span class="line">    currency</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">    $<span class="number">1</span>, $<span class="number">2</span>, $<span class="number">3</span></span><br><span class="line">) RETURNING <span class="operator">*</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: GetAccount :one</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> $<span class="number">1</span> LIMIT <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: GetAccountForUpdate :one</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> $<span class="number">1</span> LIMIT <span class="number">1</span></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">NO</span> KEY <span class="keyword">UPDATE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: ListAccounts :many</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> accounts</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> id</span><br><span class="line">LIMIT $<span class="number">1</span></span><br><span class="line"><span class="keyword">OFFSET</span> $<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: UpdateAccount :one</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts</span><br><span class="line"><span class="keyword">SET</span> balance <span class="operator">=</span> $<span class="number">2</span></span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> $<span class="number">1</span></span><br><span class="line">RETURNING <span class="operator">*</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: AddAccountBalance :one</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts</span><br><span class="line"><span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> sqlc.arg(amount)</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> sqlc.arg(id)</span><br><span class="line">RETURNING <span class="operator">*</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- name: DeleteAccount :exec</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> accounts</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">=</span> $<span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>GetAccountForUpdate<ul><li><code>FOR UPDATE</code> 解决并发查询问题</li><li><code>NO KEY</code> 指明此查询未涉及修改 key，防止死锁</li></ul></li><li>AddAccountBalance<ul><li><code>sqlc.arg(amount)</code> 指明生成结构体的参数名</li></ul></li></ul><h2 id="Mock-创建测试用例">Mock 创建测试用例</h2><ol><li>创建 test</li><li>新建 controller</li><li>新建 store 存储并传入 controller</li><li>执行 <code>store.EXPECT()</code> 创建 stubs 指定测试流程</li><li>启动测试服务器</li><li>使用 <code>httptest</code> 包创建 Recorder 记录响应</li><li>使用 <code>http</code> 包创建请求并发送</li><li>解析 recorder 完成测试</li></ol><h3 id="创建测试集">创建测试集</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">testCases := []<span class="keyword">struct</span> &#123;</span><br><span class="line">		name          <span class="type">string</span></span><br><span class="line">		accountID     <span class="type">int64</span></span><br><span class="line">		buildStubs    <span class="function"><span class="keyword">func</span><span class="params">(store *mockDB.MockStore)</span></span></span><br><span class="line">		checkResponse <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T, recorder *httptest.ResponseRecorder)</span></span></span><br><span class="line">	&#125;&#123;</span><br><span class="line">		&#123;</span><br><span class="line">			name:      <span class="string">&quot;OK&quot;</span>,</span><br><span class="line">			accountID: account.ID,</span><br><span class="line">			buildStubs: <span class="function"><span class="keyword">func</span><span class="params">(store *mockDB.MockStore)</span></span> &#123;</span><br><span class="line">				store.EXPECT().</span><br><span class="line">					GetAccount(gomock.Any(), gomock.Eq(account.ID)).</span><br><span class="line">					Times(<span class="number">1</span>).</span><br><span class="line">					Return(account, <span class="literal">nil</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			checkResponse: <span class="function"><span class="keyword">func</span><span class="params">(t *testing.T, recorder *httptest.ResponseRecorder)</span></span> &#123;</span><br><span class="line">				require.Equal(t, http.StatusOK, recorder.Code)</span><br><span class="line">				requireBodyMatchAccount(t, recorder.Body, account)</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="启动-gin-测试模式">启动 gin 测试模式</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMain</span><span class="params">(m *testing.M)</span></span> &#123;</span><br><span class="line">	gin.SetMode(gin.TestMode)</span><br><span class="line">	os.Exit(m.Run())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Gin">Gin</h1><h2 id="Validator">Validator</h2><p>使用 go 的 <code>go-playground/validator/v10</code> 和 gin 的 binding 包对 api 查询参数进行解析，对请求发送的参数内容进行限制</p><p><code>util/validator.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/go-playground/validator/v10&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ValidCurrency validator.Func = <span class="function"><span class="keyword">func</span><span class="params">(fieldLevel validator.FieldLevel)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> currency, ok := fieldLevel.Field().Interface().(<span class="type">string</span>); ok &#123;</span><br><span class="line">		<span class="comment">// 自定义方法</span></span><br><span class="line">		<span class="keyword">return</span> IsSupportedCurrency(currency)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	USD = <span class="string">&quot;USD&quot;</span></span><br><span class="line">	EUR = <span class="string">&quot;EUR&quot;</span></span><br><span class="line">	CAD = <span class="string">&quot;CAD&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsSupportedCurrency</span><span class="params">(currency <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> currency &#123;</span><br><span class="line">	<span class="keyword">case</span> USD, EUR, CAD:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>server.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">(store db.Store)</span></span> *Server &#123;</span><br><span class="line">	server := &amp;Server&#123;store: store&#125;</span><br><span class="line">	router := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注册自定义的validator，名为currency</span></span><br><span class="line">	<span class="keyword">if</span> v, ok := binding.Validator.Engine().(*validator.Validate); ok &#123;</span><br><span class="line">		v.RegisterValidation(<span class="string">&quot;currency&quot;</span>, util.ValidCurrency)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	router.POST(<span class="string">&quot;/accounts&quot;</span>, server.createAccount)</span><br><span class="line">	router.GET(<span class="string">&quot;/accounts/:id&quot;</span>, server.getAccount)</span><br><span class="line">	router.GET(<span class="string">&quot;/accounts&quot;</span>, server.listAccount)</span><br><span class="line"></span><br><span class="line">	router.POST(<span class="string">&quot;/transfer&quot;</span>, server.createTransfer)</span><br><span class="line"></span><br><span class="line">	server.router = router</span><br><span class="line">	<span class="keyword">return</span> server</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用方法：</p><p>在 binding 处添加自定义的 validator 名即可</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> transferRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">	FromAccountID <span class="type">int64</span>  <span class="string">`json:&quot;from_account_id&quot; binding:&quot;required,min=1&quot;`</span></span><br><span class="line">	ToAccountID   <span class="type">int64</span>  <span class="string">`json:&quot;to_account_id&quot; binding:&quot;required,min=1&quot;`</span></span><br><span class="line">	Amount        <span class="type">int64</span>  <span class="string">`json:&quot;amount&quot; binding:&quot;required,gt=0&quot;`</span></span><br><span class="line">	Currency      <span class="type">string</span> <span class="string">`json:&quot;currency&quot; binding:&quot;required,currency&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="gRPC">gRPC</h1><h2 id="protobuf-install">protobuf install</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y protobuf-compiler</span><br><span class="line"></span><br><span class="line">go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.28</span><br><span class="line"></span><br><span class="line">go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.2</span><br></pre></td></tr></table></figure><h2 id="Evans">Evans</h2><p>开启反射，让 evans 可以读取</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gRPCServer := grpc.NewServer()</span><br><span class="line">pb.RegisterSimpleBankServer(gRPCServer, server)</span><br><span class="line">reflection.Register(gRPCServer)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入服务器</span></span><br><span class="line">evans -r repl --port 9797 --host localhost</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看包</span></span><br><span class="line">show package</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择包</span></span><br><span class="line">package pb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择服务</span></span><br><span class="line">service simplebank</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行</span></span><br><span class="line">call ...</span><br></pre></td></tr></table></figure><h2 id="gateway">gateway</h2><p><img src="../../static/project/grpc%20gateway.png" alt=""></p><p>使用 gateway 转换 http 请求让服务器可以处理 http 请求并返回网页可读取的 json 格式数据</p><h1 id="tip">tip</h1><h2 id="testing">testing</h2><h3 id="跳过测试">跳过测试</h3><p>在需要跳过的地方添加以下代码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> testing.Short() &#123;</span><br><span class="line">	t.skip()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试时添加 <code>-short</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go <span class="built_in">test</span> -v -cover -short ./...</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>go simpleBank project</p><p><a href="https://tomatoblog.netlify.app/Project/simpleBank/">https://tomatoblog.netlify.app/Project/simpleBank/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>TOMATO</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2024-03-12</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2024-03-31</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/go/">go</a><a class="link-muted mr-2" rel="tag" href="/tags/simpleBank/">simpleBank</a></div></article></div><div class="card"><nav class="post-navigation mt-4 level is-mobile card-content"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/BackEnd/sql/isolation/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SQL 隔离等级</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/BackEnd/go/go%20context/"><span class="level-item">Go context</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div></div><style>.column.column-left,.column.column-right{display:none}</style><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/static/avatar.jpg" alt="ToMaTo"></figure><p class="title is-size-4 is-block" style="line-height:inherit">ToMaTo</p><p class="is-size-6 is-block">Back-end Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>GuangZhou, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">59</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/dontSerious/" target="_blank" rel="noopener" id="widget-follow">Github</a></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">2024年04月</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">2024年03月</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">2024年02月</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">2023年12月</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">2023年11月</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">2023年10月</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">2023年09月</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">2023年08月</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">2023年06月</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">2023年05月</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">2023年04月</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">2023年03月</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">2023年02月</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time datetime="2024-04-28T10:24:18.000Z">2024-04-28</time></p><p class="title"><a href="/FrontEnd/Flutter/">flutter 笔记</a></p><p class="categories"><a href="/categories/FrontEnd/">FrontEnd</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-03-26T06:43:15.000Z">2024-03-26</time></p><p class="title"><a href="/Interview/go/">go面试</a></p><p class="categories"><a href="/categories/Interview/">Interview</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-03-26T02:10:11.000Z">2024-03-26</time></p><p class="title"><a href="/Interview/datastruct/">数据结构和算法面试</a></p><p class="categories"><a href="/categories/Interview/">Interview</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-03-26T02:10:11.000Z">2024-03-26</time></p><p class="title"><a href="/Interview/distributed/">分布式面试</a></p><p class="categories"><a href="/categories/Interview/">Interview</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2024-03-16T07:28:10.000Z">2024-03-16</time></p><p class="title"><a href="/BackEnd/sql/index/">SQL 索引</a></p><p class="categories"><a href="/categories/BackEnd/">BackEnd</a></p></div></article></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#环境"><span class="level-left"><span class="level-item">1</span><span class="level-item">环境</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#go"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">go</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#第三方包"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">第三方包</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Docker-compose"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Docker-compose</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Postgres"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">Postgres</span></span></a></li></ul></li><li><a class="level is-mobile" href="#migrate"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">migrate</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#golang-invoke-migrate"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">golang invoke migrate</span></span></a></li><li><a class="level is-mobile" href="#Init-schema"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">Init_schema</span></span></a></li><li><a class="level is-mobile" href="#new-migrate-version"><span class="level-left"><span class="level-item">1.3.3</span><span class="level-item">new migrate version</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Sqlc"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">Sqlc</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#配置"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">配置</span></span></a></li><li><a class="level is-mobile" href="#可选参数"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">可选参数</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Makefile"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">Makefile</span></span></a></li><li><a class="level is-mobile" href="#Viper"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">Viper</span></span></a></li><li><a class="level is-mobile" href="#gomock"><span class="level-left"><span class="level-item">1.7</span><span class="level-item">gomock</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Custom-matcher"><span class="level-left"><span class="level-item">1.7.1</span><span class="level-item">Custom matcher</span></span></a></li></ul></li><li><a class="level is-mobile" href="#swagger"><span class="level-left"><span class="level-item">1.8</span><span class="level-item">swagger</span></span></a></li><li><a class="level is-mobile" href="#zerolog"><span class="level-left"><span class="level-item">1.9</span><span class="level-item">zerolog</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#grpc"><span class="level-left"><span class="level-item">1.9.1</span><span class="level-item">grpc</span></span></a></li><li><a class="level is-mobile" href="#HTTP"><span class="level-left"><span class="level-item">1.9.2</span><span class="level-item">HTTP</span></span></a></li></ul></li><li><a class="level is-mobile" href="#asynq"><span class="level-left"><span class="level-item">1.10</span><span class="level-item">asynq</span></span></a></li></ul></li><li><a class="level is-mobile" href="#SQL"><span class="level-left"><span class="level-item">2</span><span class="level-item">SQL</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#dbml"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">dbml</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#cli"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">cli</span></span></a></li><li><a class="level is-mobile" href="#docs"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">docs</span></span></a></li></ul></li><li><a class="level is-mobile" href="#sqlc-表查询设计"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">sqlc 表查询设计</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#account"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">account</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Mock-创建测试用例"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Mock 创建测试用例</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#创建测试集"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">创建测试集</span></span></a></li><li><a class="level is-mobile" href="#启动-gin-测试模式"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">启动 gin 测试模式</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Gin"><span class="level-left"><span class="level-item">3</span><span class="level-item">Gin</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Validator"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Validator</span></span></a></li></ul></li><li><a class="level is-mobile" href="#gRPC"><span class="level-left"><span class="level-item">4</span><span class="level-item">gRPC</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#protobuf-install"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">protobuf install</span></span></a></li><li><a class="level is-mobile" href="#Evans"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Evans</span></span></a></li><li><a class="level is-mobile" href="#gateway"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">gateway</span></span></a></li></ul></li><li><a class="level is-mobile" href="#tip"><span class="level-left"><span class="level-item">5</span><span class="level-item">tip</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#testing"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">testing</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#跳过测试"><span class="level-left"><span class="level-item">5.1.1</span><span class="level-item">跳过测试</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/BackEnd/"><span class="level-start"><span class="level-item">BackEnd</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/FrontEnd/"><span class="level-start"><span class="level-item">FrontEnd</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Interview/"><span class="level-start"><span class="level-item">Interview</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Memo/"><span class="level-start"><span class="level-item">Memo</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/categories/Project/"><span class="level-start"><span class="level-item">Project</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Study/"><span class="level-start"><span class="level-item">Study</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorial/"><span class="level-start"><span class="level-item">Tutorial</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Flutter/"><span class="tag">Flutter</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MIT6-S081/"><span class="tag">MIT6.S081</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React/"><span class="tag">React</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue-js/"><span class="tag">Vue.js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bookNote/"><span class="tag">bookNote</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/career/"><span class="tag">career</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cpp/"><span class="tag">cpp</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cs/"><span class="tag">cs</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/csapp/"><span class="tag">csapp</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/curriculum/"><span class="tag">curriculum</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dataStruct/"><span class="tag">dataStruct</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/datastruct/"><span class="tag">datastruct</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/distributed/"><span class="tag">distributed</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/go/"><span class="tag">go</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/live/"><span class="tag">live</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/log/"><span class="tag">log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/memo/"><span class="tag">memo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/network/"><span class="tag">network</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/nodejs/"><span class="tag">nodejs</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/obsidian/"><span class="tag">obsidian</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/project/"><span class="tag">project</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/psychology/"><span class="tag">psychology</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/simpleBank/"><span class="tag">simpleBank</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/sql/"><span class="tag">sql</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag">10</span></a></div></div></div></div></div></div><style>.column.column-left,.column.column-right{display:block}</style></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img class="logo-img" src="/static/avatar.jpg" alt="Tomato&#039;s Blog" height="28"><img class="logo-img-dark" src="/static/avatar.jpg" alt="Tomato&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 TOMATO</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/imaegoo/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/deed.zh"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="/js/imaegoo/jquery/3.3.1/dist/jquery.min.js"></script><script src="/js/imaegoo/moment/2.22.2/min/moment-with-locales.min.js"></script><script src="/js/imaegoo/clipboard/2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="/js/column.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="/js/imaegoo/cookieconsent/3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-right",
        content: {
          message: "此网站使用 Cookie，以启用评论系统和分析功能。",
          dismiss: "知道了",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="/js/imaegoo/lightgallery/1.10.0/dist/js/lightgallery.min.js" defer></script><script src="/js/imaegoo/justifiedGallery/3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><div class="searchbox-pinyin"><label class="checkbox"><input id="search-by-pinyin" type="checkbox" checked><span> 拼音检索</span></label></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/imaegoo/pinyin.js" defer></script><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"想要查找什么...",untitled:"(无标题)",posts:"文章",pages:"页面",categories:"分类",tags:"标签"})})</script><script type="text/javascript" src="/js/imaegoo/imaegoo.js"></script><script type="text/javascript" src="/js/imaegoo/universe.js"></script></body></html>